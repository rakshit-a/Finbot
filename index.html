<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finbot - Investment Dashboard</title>
    <style>
        :root {
            --primary: #2962ff;
            --secondary: #1a237e;
            --success: #00c853;
            --danger: #ff1744;
            --background: #0a0f2d;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text: #e0e6ff;
            --glow: 0 0 10px rgba(41, 98, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--background), #1a1f4d);
            color: var(--text);
            padding: 20px;
            min-height: 100vh;
        }

        .ticker {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            padding: 15px 0;
            overflow: hidden;
            white-space: nowrap;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.1);
        }

        .ticker-content {
            display: inline-block;
            animation: ticker 30s linear infinite;
        }

        .stock-item {
            display: inline-block;
            margin: 0 40px;
            font-weight: 500;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--glow);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: cardFloat 3s ease-in-out infinite;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.08);
        }

        .search-bar {
            width: 100%;
            padding: 15px 25px;
            border: 2px solid rgba(41, 98, 255, 0.3);
            border-radius: 25px;
            font-size: 16px;
            margin: 20px 0;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            backdrop-filter: blur(5px);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(41, 98, 255, 0.4);
        }

        .market-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .metric-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease;
        }

        .metric-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(41, 98, 255, 0.3);
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .radio-group {
            margin: 15px 0;
        }

        .radio-group label {
            display: block;
            margin: 12px 0;
            padding: 12px 20px;
            background: #f8faff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-group label:hover {
            background: #eef2ff;
        }

        .radio-group input[type="radio"] {
            margin-right: 10px;
        }

        .plan-info {
            text-align: center;
            color: #666;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8faff, #eef2ff);
            border-radius: 12px;
        }

        .plan-info a {
            display: inline-block;
            margin-top: 10px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 25px;
            background: white;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.1);
            transition: all 0.3s ease;
        }

        .plan-info a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(41, 98, 255, 0.2);
        }

        h1, h2, h3 {
            color: #1a237e;
            margin-bottom: 15px;
        }

        .welcome-message {
            color: #666;
            font-size: 1.1em;
            margin: 10px 0;
            line-height: 1.6;
        }

        .badge-progress {
            background: #eef2ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .up-trend {
            color: var(--success);
            font-weight: 500;
        }

        .down-trend {
            color: var(--danger);
            font-weight: 500;
        }

        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        @media (max-width: 768px) {
            .stocks-grid, .market-metrics {
                grid-template-columns: 1fr;
            }
        }

        .search-results {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            animation: modalSlideIn 0.5s ease-out;
        }

        .search-results.active {
            display: block;
        }

        .search-results h2 {
            margin-bottom: 20px;
            color: var(--secondary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .search-results-content {
            line-height: 1.6;
            color: var(--text);
        }

        .search-results .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--danger);
        }

        .loading-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
        }

        .loading-animation {
            width: 100px;
            height: 100px;
            position: relative;
            margin-bottom: 20px;
        }

        .loading-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px solid transparent;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-circle:nth-child(2) {
            border-top-color: var(--secondary);
            animation-delay: 0.3s;
        }

        .loading-circle:nth-child(3) {
            border-top-color: var(--success);
            animation-delay: 0.6s;
        }

        .loading-message {
            color: var(--text);
            font-size: 1.2em;
            margin-top: 20px;
            opacity: 0;
            animation: fadeInOut 4s infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from {
                transform: translate(-50%, -40%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Stock Ticker -->
    <div class="ticker">
        <div class="ticker-content" id="ticker"></div>
    </div>

    <!-- Profile Section -->
    <div class="card">
        <h1>Good morning, Deven! üëã</h1>
        <div class="badge-progress">
            <p>Complete your profile to collect your first badge! üèÜ</p>
        </div>
        <div class="stocks-grid">
            <div>
                <input type="text" class="search-bar" placeholder="üîç Search for a company">
                <p class="welcome-message">Welcome to Finbot! Search for any company to get detailed insights for investing.</p>
            </div>
            <div class="radio-group">
                <h3>Market View</h3>
                <label><input type="radio" name="view"> üìà Bullish</label>
                <label><input type="radio" name="view"> üìâ Bearish</label>
                <label><input type="radio" name="view"> üìä Neutral</label>
            </div>
        </div>
    </div>

    <!-- Market Metrics -->
    <div class="card">
        <h2>üìä Overall Market</h2>
        <div class="market-metrics">
            <div class="metric-item">
                <h3>NIFTY</h3>
                <p>23,482.15 <span class="up-trend">‚ñ≤ 0.11%</span></p>
            </div>
            <div class="metric-item">
                <h3>SENSEX</h3>
                <p>77,505.96 <span class="up-trend">‚ñ≤ 0.01%</span></p>
            </div>
            <div class="metric-item">
                <h3>Stock Traded</h3>
                <p>4,273</p>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="card">
        <div class="stats-grid">
            <div class="metric-item">
                <h3>üìö Stocks Researched</h3>
                <p>0</p>
            </div>
            <div class="metric-item">
                <h3>üéØ Screens Created</h3>
                <p>0</p>
            </div>
            <div class="metric-item">
                <h3>‚≠ê Watchlisted Stocks</h3>
                <p>0</p>
            </div>
        </div>
    </div>

    <!-- Plan Info -->
    <div class="plan-info">
        <p>You're enjoying standard plan</p>
        <a href="#">Upgrade to premium ‚Üí</a>
    </div>

    <!-- Add these elements before closing body tag -->
    <div class="overlay" id="overlay"></div>
    <div class="loading-container" id="loadingContainer">
        <div class="loading-animation">
            <div class="loading-circle"></div>
            <div class="loading-circle"></div>
            <div class="loading-circle"></div>
        </div>
        <div class="loading-message" id="loadingMessage"></div>
    </div>
    <div class="search-results" id="searchResults">
        <button class="close-btn" onclick="closeResults()">√ó</button>
        <h2>Company Analysis</h2>
        <div class="search-results-content" id="searchResultsContent"></div>
    </div>

    <script>
        // Stock Ticker Data
        const stocks = [
            'RELIANCE: ‚Çπ2,856.15 ‚ñ≤1.2%',
            'TCS: ‚Çπ3,415.50 ‚ñº0.8%',
            'HDFCBANK: ‚Çπ1,645.30 ‚ñ≤0.5%',
            'INFY: ‚Çπ1,530.80 ‚ñ≤2.1%',
            'SBIN: ‚Çπ595.45 ‚ñº1.1%',
            'TATAMOTORS: ‚Çπ985.60 ‚ñ≤3.2%'
        ];

        function updateTicker() {
            const ticker = document.getElementById('ticker');
            ticker.innerHTML = stocks.map(stock => 
                `<div class="stock-item">${stock}</div>`
            ).join('');
        }
        updateTicker();

        // Update the search functionality
        const searchBar = document.querySelector('.search-bar');
        const overlay = document.getElementById('overlay');
        const searchResults = document.getElementById('searchResults');
        
        searchBar.addEventListener('keypress', async function(e) {
            if (e.key === 'Enter') {
                const searchQuery = this.value.trim().toUpperCase();
                if (searchQuery) {
                    showLoading();
                    try {
                        const analysis = await getCompanyAnalysis(searchQuery);
                        displayResults(analysis);
                    } catch (error) {
                        console.error('Error:', error);
                        displayResults('Sorry, there was an error analyzing the company. Please try again.');
                    }
                    hideLoading();
                }
            }
        });

        async function getCompanyAnalysis(company) {
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer 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",
                    "HTTP-Referer": "https://finbot.com",
                    "X-Title": "Finbot Investment Dashboard"
                },
                body: JSON.stringify({
                    "model": "google/gemini-2.0-flash-thinking-exp:free",
                    "messages": [
                        {
                            "role": "system",
                            "content": "You are a professional financial analyst providing detailed, data-driven research reports."
                        },
                        {
                            "role": "user",
                            "content": `Act as a professional financial analyst. Provide a detailed, data-driven research report on the stock ${company} with the following sections:

Latest Results Overview
‚Ä¢ Summarize the most recent earnings report (date, revenue, EPS vs. estimates, key surprises)
‚Ä¢ Highlight management commentary on growth, risks, and guidance

Financial Overview
‚Ä¢ 3-year trends for revenue, net income, profit margins, and ROE/ROCE
‚Ä¢ Debt-to-equity ratio, liquidity ratios, and free cash flow analysis
‚Ä¢ Valuation metrics: P/E, PEG, P/S, and dividend yield vs. sector averages

Technical Overview
‚Ä¢ Current price action (1M/3M/1Y performance) and key support/resistance levels
‚Ä¢ Analysis of RSI, MACD, moving averages (50-day, 200-day), and volume trends
‚Ä¢ Short-term and long-term technical outlook (bullish/bearish signals)

Sector & Industry Performance
‚Ä¢ Compare the stock's performance to its sector over 6 months
‚Ä¢ Highlight industry trends impacting the stock

Additional Key Details
‚Ä¢ Insider trading activity and institutional ownership changes
‚Ä¢ Recent news (M&A, partnerships, product launches)
‚Ä¢ Analyst consensus (price targets, upgrades/downgrades)

Risks & Catalysts
‚Ä¢ Near-term risks (e.g., interest rates, competition)
‚Ä¢ Upcoming catalysts (e.g., FDA approvals, earnings dates)

Requirements:
‚Ä¢ Use the latest available data (specify sources and dates)
‚Ä¢ Present data in bullet points for clarity
‚Ä¢ Conclude with a summary of bullish/bearish arguments
‚Ä¢ Avoid speculation; focus on facts and trends

End with Symbol: ${company}`
                        }
                    ]
                })
            });

            if (!response.ok) {
                throw new Error(`API call failed: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        function displayResults(content) {
            const resultContent = document.getElementById('searchResultsContent');
            // Enhanced formatting for the comprehensive report structure
            const formattedContent = content
                // Format section breaks
                .replace(/---/g, '<hr style="border: 1px solid var(--primary); margin: 20px 0;">')
                // Format main headers
                .replace(/##\s(.*?)\n/g, '<h2 style="color: var(--secondary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-top: 20px;">$1</h2>')
                // Format sub-headers with numbers
                .replace(/\*\*(\d+\.\s.*?)\*\*/g, '<h3 style="color: var(--primary); margin-top: 15px;">$1</h3>')
                // Format other bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--primary)">$1</strong>')
                // Format bullet points
                .replace(/\*\s(.*?)\n/g, '<br>‚Ä¢ $1\n')
                // Format sub-bullet points with indentation
                .replace(/\s{4}\*\s(.*?)\n/g, '<br>&nbsp;&nbsp;&nbsp;&nbsp;‚óã $1\n')
                // Format placeholders and variables
                .replace(/\[(.*?)\]/g, '<span style="color: #666; font-style: italic">$1</span>')
                // Format source references
                .replace(/\[Source:.*?\]/g, '<span style="color: #666; font-size: 0.9em;">$&</span>')
                // Format data points and metrics
                .replace(/([‚Çπ\$][\d,\.]+(?:\scrore)?)/g, '<span style="color: var(--primary); font-weight: bold;">$1</span>')
                .replace(/(\d+(?:\.\d+)?%)/g, '<span style="color: var(--primary); font-weight: bold;">$1</span>')
                // Format line breaks
                .replace(/\n/g, '<br>')
                // Format the stock symbol at the end
                .replace(/Symbol: (.*?)$/g, '<br><br><strong style="color: var(--secondary); font-size: 1.2em; display: block; text-align: center; padding: 10px; background: #f8faff; border-radius: 8px;">Symbol: $1</strong>')
                // Format disclaimer
                .replace(/Disclaimer:(.*?)\n/g, '<div style="background: #fff4e5; padding: 15px; border-radius: 8px; margin: 20px 0;"><strong>Disclaimer:</strong>$1</div>');
            
            resultContent.innerHTML = formattedContent;
            
            overlay.classList.add('active');
            searchResults.classList.add('active');
        }

        function closeResults() {
            overlay.classList.remove('active');
            searchResults.classList.remove('active');
        }

        const loadingMessages = [
            "Your comprehensive Stock Report is Loading...",
            "Scraping Data from All Over the Web...",
            "Combining All the Financial Statements...",
            "Using AI to Turn Research into Gold...",
            "Consulting with Mr. Warren Buffett...",
            "Analyzing Market Sentiment...",
            "Crunching the Numbers...",
            "Reading Through Annual Reports...",
            "Checking Insider Trading Patterns...",
            "Finalizing Your Report..."
        ];

        function showLoading() {
            const loadingContainer = document.getElementById('loadingContainer');
            const loadingMessage = document.getElementById('loadingMessage');
            loadingContainer.style.display = 'block';
            overlay.classList.add('active');

            let messageIndex = 0;
            loadingMessage.textContent = loadingMessages[0];

            const messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                loadingMessage.textContent = loadingMessages[messageIndex];
            }, 4000);

            // Store the interval ID for cleanup
            loadingContainer.dataset.intervalId = messageInterval;
        }

        function hideLoading() {
            const loadingContainer = document.getElementById('loadingContainer');
            clearInterval(parseInt(loadingContainer.dataset.intervalId));
            loadingContainer.style.display = 'none';
        }

        // Close results when clicking overlay
        overlay.addEventListener('click', closeResults);
    </script>
</body>
</html>
